
# The Narvik Crisis
ENG_narvik_crisis_cat = {

	# Sabotage the Swedish Mines
	ENG_narvik_crisis_blow_up_mines = {
		icon = generic_operation
		available = {
			OR = {
				controls_province = 3095
				any_allied_country = {
					controls_province = 3095
				}
			}
			OR = {
				controls_province = 11155
				any_allied_country = {
					controls_province = 11155
				}
			}
			OR = {
				has_active_mission = ENG_explode_the_swedish_iron_ore_mine
				has_war_with = SWE
			}
		}

		visible = {
			NOT = {
				666 = { 
					has_dynamic_modifier = {
						modifier = SWE_blown_up_mines
					}
				}
			}
		}
		cancel_trigger = {
			NOT = {
				controls_province = 3095
				controls_province = 11155
				OR = {
					has_active_mission = ENG_explode_the_swedish_iron_ore_mine 
					has_war_with = SWE
				}
			}

		}
		days_remove = 12
		complete_effect = {
			add_days_mission_timeout = {
				mission = ENG_explode_the_swedish_iron_ore_mine
				days = 13
			}
		}
		remove_effect = {
			666 = {
				add_dynamic_modifier = {
					modifier = SWE_blown_up_mines
				}
			}
			if = {
				limit = {
					has_country_flag = ENG_activated_plan_rfour
				}
				country_event = { id = AAT_britain_narvik.1 }
				SWE = {
					country_event = { id = AAT_britain_narvik.3 }
				}
				GER = {
					country_event = { id = AAT_britain_narvik.3 }
				}

				hidden_effect = {
					clr_country_flag = ENG_activated_plan_rfour
				}
			}
		}

		ai_will_do = {
			base = 100
		}
	}

	# Plan R4 
	ENG_explode_the_swedish_iron_ore_mine = { 

		icon = eng_support_imperialist_coup
		
		available = {
			666 = {
				has_dynamic_modifier = {
					modifier = SWE_blown_up_mines
				}
			}
		}
		activation = {
			always = no
		}
		days_mission_timeout = 60
		fire_only_once = yes

		visible = {
			always = yes
		}

		cancel_if_not_visible = no

		is_good = no

		complete_effect = {
			
		}

		timeout_effect = {
			white_peace = {
				tag = SWE
			}
			add_war_support = -0.1
			add_stability = -0.1
			custom_effect_tooltip = ENG_explode_the_swedish_iron_ore_mine_tt
		}
	}
}


ENG_imperial_conference_decision = {
	
	ENG_imperial_conference_decision = {

		icon = generic_political_discourse
		
		available = {
			hidden_trigger = { always = no }
		}

		days_mission_timeout = 60

		fire_only_once = yes

		activation = {
			tag = ENG
			has_country_flag = ENG_imperial_conference_timer_flag
		}

		visible = {
			tag = ENG
			has_country_flag = ENG_imperial_conference_timer_flag
		}

		cancel_if_not_visible = no

		is_good = yes

		complete_effect = {
			
		}

		timeout_effect = {
			custom_effect_tooltip = imperial_conference_ends_tt
			every_country = {
				limit = {
					OR = {
						AND = {
							is_subject_of = ENG
							tag = CAN
						}
						AND = {
							is_subject_of = ENG
							tag = SAF
						}
						AND = {
							is_subject_of = ENG
							tag = RAJ
						}
						AND = {
							is_subject_of = ENG
							tag = AST
						}
						AND = {
							is_subject_of = ENG
							tag = NZL
						}
					}
				}
				remove_opinion_modifier = { target = ENG modifier = ENG_imperial_conference_opinion }
				remove_opinion_modifier = { target = ENG modifier = ENG_imperial_conference_approved_resolution }
			}
		}
	}
	
	ENG_discuss_imperial_defense = {

		icon = eng_trade_unions_support

		allowed = {
			tag = ENG
		}

		available = {
			NOT = { has_country_flag = ENG_imperial_conference_discussion_in_progress }
		}

		cost = 50

		fire_only_once = yes

		visible = {
			has_completed_focus = ENG_imperial_conference
			has_country_flag = ENG_imperial_conference_timer_flag
		}

		complete_effect = {
			country_event = { id = mtg_britain.83 hours = 6 }
			set_country_flag = ENG_imperial_conference_discussion_in_progress
		}

		ai_will_do = {
			factor = 100
		}
	}

	ENG_discuss_imperial_trade = {

		icon = eng_trade_unions_support

		allowed = {
			tag = ENG
		}

		available = {
			NOT = { has_country_flag = ENG_imperial_conference_discussion_in_progress }
		}

		cost = 50

		fire_only_once = yes

		visible = {
			has_completed_focus = ENG_imperial_conference
			has_country_flag = ENG_imperial_conference_timer_flag
		}

		complete_effect = {
			country_event = { id = mtg_britain.87 hours = 6 }
			set_country_flag = ENG_imperial_conference_discussion_in_progress
		}

		ai_will_do = {
			factor = 100
		}
	}

	ENG_discuss_imperial_economy = {

		icon = eng_trade_unions_support

		allowed = {
			tag = ENG
		}

		available = {
			NOT = { has_country_flag = ENG_imperial_conference_discussion_in_progress }
		}

		cost = 50

		fire_only_once = yes

		visible = {
			has_completed_focus = ENG_imperial_conference
			has_country_flag = ENG_imperial_conference_timer_flag
		}

		complete_effect = {
			country_event = { id = mtg_britain.91 hours = 6 }
			set_country_flag = ENG_imperial_conference_discussion_in_progress
		}

		ai_will_do = {
			factor = 100
		}
	}

	ENG_discuss_appeasement = {

		icon = eng_trade_unions_support

		allowed = {
			tag = ENG
		}

		available = {
			NOT = { has_country_flag = ENG_imperial_conference_discussion_in_progress }
			has_war = no
		}

		cost = 50

		fire_only_once = yes

		visible = {
			has_completed_focus = ENG_imperial_conference
			has_country_flag = ENG_imperial_conference_timer_flag
		}

		complete_effect = {
			country_event = { id = mtg_britain.95 hours = 6 }
			set_country_flag = ENG_imperial_conference_discussion_in_progress
		}

		ai_will_do = {
			factor = 100
		}
	}

	ENG_discuss_imperial_federation = {

		icon = eng_imperial_federation

		allowed = {
			tag = ENG
		}

		available = {
			NOT = { has_country_flag = ENG_imperial_conference_discussion_in_progress }
			OR = {
				CAN = { exists = yes }
				SAF = { exists = yes }
				AST = { exists = yes }
				NZL = { exists = yes }
				AND = {
					RAJ = { is_subject_of = ENG }
					has_completed_focus = ENG_indian_autonomy
				}
			}
		}

		cost = 100

		fire_only_once = yes

		visible = {
			has_completed_focus = ENG_imperial_conference
			has_country_flag = ENG_imperial_conference_timer_flag
		}

		complete_effect = {
			country_event = { id = mtg_britain.99 hours = 6 }
			set_country_flag = ENG_imperial_conference_discussion_in_progress
			if = {
				limit = {
					NOT = { has_completed_focus = ENG_indian_autonomy }
				}
				custom_effect_tooltip = ENG_indian_autonomy_tt
			}
		}

		ai_will_do = {
			factor = 100
		}
	}
}

political_actions = {
hold_blood_toil_tears_sweat_speech = {

		icon = generic_political_discourse

		allowed = {
			tag = ENG
		}

		available = {
			has_government = democratic
			has_country_leader = { ruling_only = yes character = ENG_winston_churchill }
			has_war_with = GER
		}

		cost = 50

		fire_only_once = yes

		visible = {
			tag = ENG
			has_government = democratic
			has_war_with = GER
			has_country_leader = { ruling_only = yes character = ENG_winston_churchill }
		}

		complete_effect = {
			add_stability = 0.05
			add_war_support = 0.05
			if = {
				limit = {
					USA = {
						exists = yes
						has_war = no
						has_government = ROOT
					}
				}
				USA = { set_country_flag = blood_toil_tears_sweat_speech }
			}
			set_country_flag = blood_toil_tears_sweat_speech
			play_blood_toil_tears_sweat_effect = yes
		}

		ai_will_do = {
			base = 50 #Gotta allow the Americans to help
			modifier = {
				factor = 4
				FRA = {
					has_capitulated = yes
				}
			}
			modifier = {
				factor = 2
				POL = {
					has_capitulated = yes
				}
			}
		}
	}

	hold_fight_on_the_beaches_speech = {

		icon = generic_political_discourse

		allowed = {
			tag = ENG
		}

		available = {
			has_government = democratic
			has_country_leader = { ruling_only = yes character = ENG_winston_churchill }
			has_war_with = GER
			is_in_faction_with = FRA
			FRA = {
				surrender_progress > 0.2
			}
		}

		cost = 50

		fire_only_once = yes

		visible = {
			tag = ENG
			has_government = democratic
			has_war_with = GER
			has_country_flag = blood_toil_tears_sweat_speech
			has_country_leader = { ruling_only = yes character = ENG_winston_churchill }
		}

		complete_effect = {
			add_war_support = 0.05
			if = {
				limit = {
					USA = {
						exists = yes
						has_war = no
						has_government = ROOT
					}
				}
				USA = { set_country_flag = fight_on_the_beaches_speech }
			}
			set_country_flag = fight_on_the_beaches_speech
			play_we_shall_fight_on_the_beaches_effect = yes
		}

		ai_will_do = {
			base = 50 #Gotta allow the Americans to help
			modifier = {
				factor = 4
				FRA = {
					has_capitulated = yes
				}
			}
		}
	}

	hold_this_was_their_finest_hour_speech = {

		icon = generic_political_discourse

		allowed = {
			tag = ENG
		}

		available = {
			has_government = democratic
			has_country_leader = { ruling_only = yes character = ENG_winston_churchill }
			has_war_with = GER
			is_in_faction_with = FRA
			FRA = { has_capitulated = yes }
		}

		cost = 50

		fire_only_once = yes

		visible = {
			tag = ENG
			has_government = democratic
			has_war_with = GER
			has_country_flag = fight_on_the_beaches_speech
			has_country_leader = { ruling_only = yes character = ENG_winston_churchill }
		}

		complete_effect = {
			add_war_support = 0.05
			if = {
				limit = {
					USA = {
						exists = yes
						has_war = no
						has_government = ROOT
					}
				}
				USA = { set_country_flag = this_was_their_finest_hour_speech }
			}
			set_country_flag = this_was_their_finest_hour_speech
			play_their_finest_hour_effect = yes
		}

		ai_will_do = {
			base = 50 #Gotta allow the Americans to help
			modifier = {
				factor = 4
				FRA = {
					has_capitulated = yes
				}
			}
		}
	}

	macdonald_proposal = {
	
		allowed = {
			tag = ENG
		}
		
		available = {
			tag = ENG
			has_government = democratic
			has_war_with = GER
			NOT = {
				has_war_with = IRE
			}
			IRE = { exists = yes }
			NOT = { is_in_faction_with = IRE }
			FRA = { has_capitulated = yes }
			is_in_faction_with = FRA
		}

		cost = 50

		fire_only_once = yes
		
		visible = {
			tag = ENG
			has_government = democratic
			has_war_with = GER
			IRE = { exists = yes }
			NOT = { is_in_faction_with = IRE }
		}
		
		complete_effect = {
			IRE = { 
				country_event = { 
					id = wtt_britain.24 
					hours = 6
				} 
			}
			add_popularity = { 
				ideology = democratic 
				popularity = 0.03 
			}
			add_stability = -0.05
		}

		ai_will_do = {
			base = 1
		}
	}

	ENG_invoke_the_alliance_of_1373 = {

		icon = generic_prepare_civil_war
	
		allowed = {
			tag = ENG
		}
		
		available = {
			has_war = yes
			has_government = democratic
			POR = {
				OR = {
					has_government = ROOT
					has_government = neutrality
				}
			}
			POR = { is_in_faction = no }
			is_faction_leader = yes
		}

		cost = 100
		
		visible = {
			has_war = yes
			NOT = { has_war_with = POR }
			POR = { is_in_faction = no }
		}
		
		complete_effect = {
			ENG = {
				hidden_effect = {
					save_event_target_as = alliance_inviter
				}
			}

			POR = {
				country_event = generic.5
				country_event = {
					id = generic.5
					hours = 6
				}	
			}
		}

		ai_will_do = {
			base = 2
			modifier = {
				factor = 0
				NOT = {
					any_enemy_country = {
						original_tag = SPR
					}
				}
			}
		}
	}

	ENG_request_azores_lease = {
	
		allowed = {
			tag = ENG
		}
		
		available = {
			has_war = yes
			has_government = democratic
			POR = {
				has_full_control_of_state = 698
				OR = {
					has_government = ROOT
					has_government = neutrality
				}
			}
			POR = { is_in_faction = no }
		}

		cost = 50

		fire_only_once = yes

		ai_will_do = {
			base = 10
		}
		
		visible = {
			has_war = yes
			POR = {
				has_full_control_of_state = 698
				NOT = { has_war_with = ROOT }
			}
		}
		
		complete_effect = {
			POR = { 
				country_event = {
					id = wtt_britain_lease_azores.1
					hours = 6
				}	
			}
		}
	}

	ENG_abdication_crisis = { # timer for the player to see when the event chain ends

		priority = 10

		icon = eng_abdication_crisis
		
		available = {
			has_country_flag = ENG_abdication_crisis_changed_mind
		}

		days_mission_timeout = 200

		fire_only_once = yes

		activation = {
			tag = ENG
			OR = {
				has_country_flag = ENG_abdication_crisis_normal_marriage
				has_country_flag = ENG_abdication_crisis_morganatic_marriage
			}
		}

		visible = {
			tag = ENG
			NOT = {
				has_country_flag = ENG_edward_viii_abdicated
				has_country_flag = edward_viii_married_wallis_simpson
			}
		}

		cancel_if_not_visible = yes

		is_good = yes

		complete_effect = {
			
		}

		timeout_effect = {
			country_event = { id = mtg_britain.5 }
		}
	}
}

operations = {

	operation_fork = {

		icon = generic_operation
	
		allowed = {
			tag = ENG
		}
		
		available = {
			tag = ENG
			has_government = democratic
			has_war_with = GER
			ICE = { exists = yes }
			IF = {
				limit = {
					NOR = { has_government = democratic }
				}
				NOR = { has_capitulated = yes }
				is_in_faction_with = NOR
			}
			ELSE = {
				any_country_with_original_tag = {
					original_tag_to_check = NOR 
					has_capitulated = yes
					is_in_faction_with = ROOT 
				}
			}
		}

		cost = 35

		fire_only_once = yes

		ai_will_do = {
			base = 1
			modifier = {
				factor = 200 
				ICE = {
					has_completed_focus = ICE_declare_absolute_neutrality
				}	
			}
		}
		
		visible = {
			tag = ENG
			has_war_with = GER
			ICE = { exists = yes }
			NOT = { ICE = { is_in_faction_with = ROOT } }
			ICE = {
				NOT = { has_completed_focus = ICE_united_we_stand }
			}
		}
		
		complete_effect = {
			ICE = { country_event = { id = britain.25 days = 1} }
			add_popularity = { ideology = democratic popularity = -0.05 }
		}
	}

	# the Occupation of the Faroes
	ENG_operation_valentine = {

		icon = generic_operation
	
		allowed = {
			tag = ENG
		}
		
		available = { #Dublicate of Visibility intented
			DEN = {
				is_subject = yes
				NOT = {
					is_in_faction_with = var:DEN.DEN_overlord_nation
				}
			}
			has_war_with = var:DEN.DEN_overlord_nation
			337 = {
				is_controlled_by = DEN
			}
		}

		cost = 25

		fire_only_once = yes

		ai_will_do = {
			# We want to do this
			base = 50
			modifier = {
				# Fascist Germany is a lot more scary than other versions of Germany
				factor = 2 	
				GER = {
					has_government = fascism
				}
			}
			modifier = {
				# Iceland has gone their own path, so we can consolidate the North Sea
				factor = 2 	
				ICE = {
					has_completed_focus = ICE_declare_absolute_neutrality
				}
			}
			modifier = {
				# Norway has already fallen, we are too late
				factor = 6
				any_country = {
					has_government = democratic
					original_tag = NOR
					is_in_faction_with = ROOT
					has_capitulated = yes
				}
			}
		}
		
		visible = {
			original_tag = ENG
			DEN = {
				is_subject = yes
				NOT = {
					is_in_faction_with = var:DEN.DEN_overlord_nation
				}
			}
			has_war_with = var:DEN.DEN_overlord_nation
			337 = {
				is_controlled_by = DEN
			}
			has_dlc = "Arms Against Tyranny"
		}
		
		complete_effect = {
			DEN = { country_event = { id = AAT_USA_events.02 days = 2 } }
			add_popularity = { 
				ideology = ROOT 
				popularity = -0.02
			}
			add_stability = -0.01
			ROOT = {
				transfer_state = 337
			}
			337 = {
				add_building_construction = {
					type = air_base
					level = 1
					instant_build = yes
				}
				add_building_construction = {
					type = coastal_bunker
					level = 2
					instant_build = yes
					province = 13003
				}	
			}
			hidden_effect = {
				set_global_flag = ENG_occupied_DEN_faroes
			}
		}
	}
	
	invade_ireland = {

		icon = generic_operation
	
		allowed = {
			tag = ENG
		}
		
		available = {
			tag = ENG
			has_government = democratic
			has_war_with = GER
			IRE = { exists = yes }
			NOT = { is_in_faction_with = IRE }
			IF = {
				limit = {
					NOR = { has_government = democratic }
				}
				NOR = { has_capitulated = yes }
				is_in_faction_with = NOR
			}
			ELSE = {
				any_country_with_original_tag = {
					original_tag_to_check = NOR 
					has_capitulated = yes
					is_in_faction_with = ROOT
				}
			}
			FRA = { has_capitulated = yes }
			is_in_faction_with = FRA
		}

		cost = 75
		
		fire_only_once = yes

		ai_will_do = {
			base = 0
			modifier = {
				add = 100
				any_enemy_country = {
					has_attache_from = IRE
				}
			}
			modifier = {
				add = 1
				has_opinion = { target = IRE value < -50 }
			}
			modifier = {
				add = 1
				IRE = { has_added_tension_amount > 0.05 }
			}
		}
		
		visible = {
			tag = ENG
			has_war_with = GER
			IRE = { exists = yes }
		}
		
		complete_effect = {
			add_state_claim = 113
			add_state_claim = 134
			add_state_claim = 135
			declare_war_on = { target = IRE type = annex_everything }
			add_stability = -0.05
			add_popularity = { ideology = democratic popularity = -0.03 }
		}
	}

	mers_el_kebir_raid = {

		icon = generic_naval
	
		allowed = {
			tag = ENG
		}
		
		available = {
			has_country_leader = { ruling_only = yes character = ENG_winston_churchill }
			has_government = democratic
			has_war_with = GER
			any_country_with_original_tag = {
				original_tag_to_check = FRA
				has_government = fascism
			}
		}

		cost = 100

		fire_only_once = yes

		ai_will_do = {
			base = 1
		}
		
		visible = {
			has_country_leader = { ruling_only = yes character = ENG_winston_churchill }
			tag = ENG
			has_government = democratic
			has_war_with = GER
			OR = {
				AND = {
					is_in_faction_with = FRA
					FRA = { surrender_progress > 0.2 }
				}
				any_country_with_original_tag = {
					original_tag_to_check = FRA
					has_government = fascism
				}
			}
		}
		
		complete_effect = {
			random_other_country = {
				limit = {
					original_tag = FRA
					has_government = fascism
				}
				country_event = { id = wtt_britain.25 hours = 5 }
			}
		}
	}
}
